<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Universitas Katolik Parahyangan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet" />

    <style>
      /* (Style CSS SAMA PERSIS dengan sebelumnya, tidak ada perubahan visual) */
      body {
        background-color: #f0f2f5;
        min-height: 100vh;
        width: 100vw;
        margin: 0;
        font-family: "Open Sans", sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }
      .header-logo {
        position: relative;
        width: 90vw;
        max-width: 1200px;
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
        z-index: 10;
      }
      .header-logo img {
        height: 50px;
        width: auto;
      }
      .header-text {
        display: flex;
        flex-direction: column;
        line-height: 1.1;
        color: #333;
        font-weight: 700;
        font-size: 1rem;
        text-transform: uppercase;
      }
      .login-card {
        width: 90vw;
        max-width: 1200px;
        height: 80vh;
        min-height: 500px;
        background: white;
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        display: flex;
        overflow: hidden;
      }
      .left-panel {
        flex: 1.3;
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: 60px;
        color: white;
        background: linear-gradient(135deg, rgba(63, 189, 236, 0.7) 0%, rgba(10, 88, 202, 0.8) 100%), url("https://images.unsplash.com/photo-1541339907198-e08756dedf3f?q=80&w=1000&auto=format&fit=crop");
        background-size: cover;
        background-position: center;
        background-blend-mode: multiply;
      }
      .welcome-text h2 {
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }
      .welcome-text h1 {
        font-size: 2.5rem;
        font-weight: 800;
        line-height: 1.2;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }
      .right-panel {
        flex: 1;
        background: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: 0 60px;
      }
      .form-title {
        color: #0d6efd;
        font-size: 2.2rem;
        font-weight: 800;
        margin-bottom: 2rem;
      }
      .custom-input-group {
        border: 1px solid #0d6efd;
        border-radius: 50px;
        padding: 5px 20px;
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        height: 55px;
        transition: all 0.3s;
      }
      .custom-input-group:focus-within {
        box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.1);
        background-color: #f8fbff;
      }
      .custom-input-group i {
        color: #0d6efd;
        margin-right: 15px;
        font-size: 1.1rem;
        width: 20px;
        text-align: center;
      }
      .custom-input-group input {
        border: none;
        outline: none;
        width: 100%;
        font-size: 1rem;
        color: #495057;
        background: transparent;
      }
      .btn-custom-login {
        background-color: #0d6efd;
        color: white;
        border-radius: 50px;
        height: 50px;
        font-size: 1.1rem;
        font-weight: 700;
        border: none;
        margin-top: 10px;
        transition: background-color 0.2s;
        width: 100%;
      }
      .btn-custom-login:hover {
        background-color: #0b5ed7;
      }
      /* Style untuk pesan error */
      #alertMessage {
        display: none;
        margin-bottom: 20px;
        border-radius: 10px;
        font-size: 0.9rem;
      }
      @media (max-width: 992px) {
        .login-card {
          flex-direction: column;
          height: auto;
        }
        .left-panel {
          min-height: 250px;
          padding: 40px;
        }
        .right-panel {
          padding: 40px 30px;
        }
        .header-logo {
          justify-content: flex-start;
        }
        body {
          justify-content: flex-start;
        }
      }
    </style>
  </head>
  <body>
    <div class="header-logo">
      <img src="images/LogoUnparHitam.png" alt="Logo UNPAR" />
    </div>

    <div class="login-card">
      <div class="left-panel">
        <div class="welcome-text">
          <h2>Welcome To</h2>
          <h1>Manajemen<br />Bimbingan<br />Tugas Akhir</h1>
        </div>
      </div>

      <div class="right-panel">
        <h2 class="form-title">Log In</h2>

        <div id="alertMessage" class="alert alert-danger" role="alert"></div>

        <form id="loginForm">
          <div class="custom-input-group">
            <i class="fas fa-user-circle"></i>
            <input type="text" id="email" placeholder="Email address" required />
          </div>

          <div class="custom-input-group">
            <i class="fas fa-lock"></i>
            <input type="password" id="password" placeholder="Password" required />
          </div>

          <button type="submit" class="btn btn-custom-login">Log In</button>
        </form>
      </div>
    </div>

    <script>
      document.getElementById("loginForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        // 1. Ambil elemen UI
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const btn = document.querySelector(".btn-custom-login");
        const alertBox = document.getElementById("alertMessage");

        // 2. Ubah tombol jadi loading
        const originalBtnText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Loading...';
        btn.disabled = true;
        alertBox.style.display = "none"; // Sembunyikan error lama

        try {
          // 3. Kirim data ke Backend (API yang baru kita buat)
          const response = await fetch("/api/auth/login", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ email, password }),
          });

          const result = await response.json();

          if (result.success) {
            // 1. Simpan sesi user
            localStorage.setItem("user_session", JSON.stringify(result.user));

            // 3. REDIRECT SESUAI ROLE (Logic dari Backend)
            setTimeout(() => {
              // Backend mengirimkan 'redirectUrl' berdasarkan role
              window.location.href = result.redirectUrl;
            }, 800);
          } else {
            // 5. Jika GAGAL:
            throw new Error(result.message || "Login gagal");
          }
        } catch (error) {
          // Tampilkan pesan error di atas form
          alertBox.textContent = error.message;
          alertBox.style.display = "block";

          // Kembalikan tombol seperti semula
          btn.innerHTML = originalBtnText;
          btn.disabled = false;
        }
      });
    </script>
  </body>
</html>
