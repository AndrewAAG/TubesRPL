<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalender - Student</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        /* Calendar Specific Styles */
        .calendar-container {
            background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .calendar-header-month {
            text-align: center;
            color: white;
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 25px;
        }

        .calendar-grid {
            background: white;
            border-radius: 15px;
            overflow: hidden;
        }

        .week-header {
            display: grid;
            grid-template-columns: 80px repeat(5, 1fr);
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .day-header {
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .day-number {
            display: block;
            font-size: 20px;
            color: #0d6efd;
            margin-bottom: 3px;
        }

        .time-grid {
            display: grid;
            grid-template-columns: 80px repeat(5, 1fr);
        }

        .time-label {
            padding: 20px 10px;
            text-align: right;
            font-weight: 500;
            color: #6c757d;
            border-right: 1px solid #dee2e6;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
        }

        .day-cell {
            border-right: 1px solid #f0f0f0;
            border-bottom: 1px solid #f0f0f0;
            position: relative;
            min-height: 60px;
        }

        .event {
            position: absolute;
            left: 5px;
            right: 5px;
            border-radius: 8px;
            padding: 8px;
            font-size: 12px;
            font-weight: 500;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            transition: all 0.2s;
            overflow: hidden;
        }

        .event:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        }

        .event-available {
            background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
        }

        .event-booked {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
        }

        .event-time {
            display: block;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .event-title {
            display: block;
            font-size: 11px;
            opacity: 0.95;
        }

        .event-date {
            display: block;
            font-size: 10px;
            opacity: 0.9;
            margin-top: 2px;
        }

        .calendar-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .nav-btn {
            background: white;
            border: none;
            color: #0d6efd;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background: #e7f1ff;
        }

        @media (max-width: 768px) {
            .week-header {
                grid-template-columns: 60px repeat(5, 1fr);
            }

            .time-grid {
                grid-template-columns: 60px repeat(5, 1fr);
            }

            .day-header {
                padding: 8px 5px;
                font-size: 11px;
            }

            .day-number {
                font-size: 16px;
            }

            .time-label {
                padding: 15px 5px;
                font-size: 11px;
            }

            .event {
                font-size: 10px;
                padding: 5px;
            }

            .calendar-container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid h-100">
        <div class="row h-100">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 p-0 h-100 sidebar-scrollable" id="sidebar-wrapper"></div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 h-100 p-0 position-relative">
                <div class="main-content-scrollable">
                    <!-- Header -->
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h2 class="fw-bold text-primary mb-1">Kalender</h2>
                            <p class="text-muted small">Jadwal bimbingan yang tersedia</p>
                        </div>

                        <div class="d-flex align-items-center gap-3">
                            <button class="btn btn-outline-danger btn-sm rounded-pill px-3 d-flex align-items-center gap-2">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>

                            <div class="notification-circle">
                                <i class="fas fa-bell fa-lg text-secondary"></i>
                                <span class="badge-dot">2</span>
                            </div>
                        </div>
                    </div>

                    <!-- Calendar Container -->
                    <div class="calendar-container">
                        <div class="calendar-navigation">
                            <button class="nav-btn" onclick="previousWeek()">
                                <i class="fas fa-chevron-left"></i> Minggu Sebelumnya
                            </button>
                            <div class="calendar-header-month" id="current-month">Oktober</div>
                            <button class="nav-btn" onclick="nextWeek()">
                                Minggu Berikutnya <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>

                        <div class="calendar-grid" id="calendar-grid">
                            <!-- Calendar will be rendered here -->
                        </div>
                    </div>

                    <div style="height: 50px"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="sidebar.js"></script>
    <script>
        // Data jadwal (nanti akan diambil dari API)
        let currentWeekStart = new Date(2025, 9, 6); // 6 Oktober 2025

        const scheduleData = {
            '2025-10-06': [
                { time: '10.00 - 12.00', type: 'available', title: 'Available', lecturer: null }
            ],
            '2025-10-07': [
                { time: '12.00 - 15.00', type: 'available', title: 'Available', lecturer: null }
            ],
            '2025-10-08': [
                { time: '09.00 - 12.00', type: 'booked', title: 'Pascal Alfadian', date: '09.01.21', lecturer: 'Dr. John Doe' }
            ]
        };

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            const monthYear = currentWeekStart.toLocaleDateString('id-ID', { month: 'long', year: 'numeric' });
            document.getElementById('current-month').textContent = monthYear;

            // Generate week dates
            const weekDates = [];
            for (let i = 0; i < 5; i++) {
                const date = new Date(currentWeekStart);
                date.setDate(date.getDate() + i);
                weekDates.push(date);
            }

            const dayNames = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat'];
            const timeSlots = ['07.00', '08.00', '09.00', '10.00', '11.00', '12.00', '13.00', '14.00', '15.00', '16.00', '17.00', '18.00'];

            let html = '<div class="week-header"><div class="day-header"></div>';
            
            // Header hari
            weekDates.forEach((date, i) => {
                html += `
                    <div class="day-header">
                        <span class="day-number">${date.getDate()}</span>
                        ${dayNames[i]}
                    </div>
                `;
            });
            html += '</div>';

            // Time grid
            html += '<div class="time-grid">';
            timeSlots.forEach(time => {
                html += `<div class="time-label">${time}</div>`;
                
                weekDates.forEach(date => {
                    const dateStr = date.toISOString().split('T')[0];
                    const events = scheduleData[dateStr] || [];
                    
                    html += '<div class="day-cell">';
                    
                    // Render events untuk tanggal ini
                    events.forEach(event => {
                        if (event.time.startsWith(time.substring(0, 5))) {
                            const duration = calculateDuration(event.time);
                            const eventClass = event.type === 'available' ? 'event-available' : 'event-booked';
                            
                            html += `
                                <div class="event ${eventClass}" style="height: ${duration}px;" onclick="handleEventClick('${dateStr}', '${event.time}')">
                                    <span class="event-time">${event.time}</span>
                                    <span class="event-title">${event.title}</span>
                                    ${event.date ? `<span class="event-date">${event.date}</span>` : ''}
                                </div>
                            `;
                        }
                    });
                    
                    html += '</div>';
                });
            });
            html += '</div>';

            grid.innerHTML = html;
        }

        function calculateDuration(timeRange) {
            const [start, end] = timeRange.split(' - ');
            const [startHour] = start.split('.').map(Number);
            const [endHour] = end.split('.').map(Number);
            const duration = endHour - startHour;
            return duration * 60; // 60px per jam
        }

        function handleEventClick(date, time) {
            const event = scheduleData[date]?.find(e => e.time === time);
            if (event && event.type === 'available') {
                if (confirm(`Apakah Anda ingin memesan slot ${time} pada tanggal ${date}?`)) {
                    // Di sini nanti akan memanggil API untuk booking
                    alert('Fitur booking akan segera tersedia!');
                }
            }
        }

        function previousWeek() {
            currentWeekStart.setDate(currentWeekStart.getDate() - 7);
            renderCalendar();
        }

        function nextWeek() {
            currentWeekStart.setDate(currentWeekStart.getDate() + 7);
            renderCalendar();
        }

        // Render saat halaman dimuat
        document.addEventListener('DOMContentLoaded', () => {
            renderCalendar();
        });

        // Fungsi untuk fetch data dari API (akan diimplementasikan nanti)
        async function fetchCalendarData() {
            try {
                const userSession = JSON.parse(localStorage.getItem('user_session'));
                // const response = await fetch(`/api/schedules/calendar/${userSession.user_id}`);
                // const result = await response.json();
                // Update scheduleData dengan data dari API
            } catch (error) {
                console.error('Error fetching calendar data:', error);
            }
        }
    </script>
</body>
</html>